)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
log_number_post_offices = log(n()),
active_post_offices = case_when(
)
)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
log_number_post_offices = log(n())
)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L)
)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
case_when(
discontinued_year = is.na() ~ "Active",
TRUE ~ "Closed"
)
)
?case_when
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
case_when(
is.na(discontinued_year) ~ "Active",
TRUE ~ "Closed"
)
)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ "Active",
TRUE ~ "Closed")
) %>%
group_by(active_post_offices) %>%
summarize_by_time(year, .by = "year",
cumulative_post_offices = cumsum(n()))
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ "Active",
TRUE ~ "Closed")
) %>%
group_by(active_post_offices)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ "Active",
TRUE ~ "Closed")
) %>%
group_by(active_post_offices) %>%
summarize_by_time(year, .by = "year",
active_post_offices = n())
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ "Active",
TRUE ~ "Closed")
) %>%
group_by(active_post_offices) %>%
summarize_by_time(established_year, .by = "year",
active_post_offices = n()) %>% ungroup()
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ "Active",
TRUE ~ "Closed")
) %>%
# group_by(active_post_offices) %>%
# summarize_by_time(established_year, .by = "year",
#                   active_post_offices = n()) %>% ungroup()
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
log_number_post_offices = log(n())
) %>% ungroup
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ "Active",
TRUE ~ "Closed")
) %>%
# group_by(active_post_offices) %>%
# summarize_by_time(established_year, .by = "year",
#                   active_post_offices = n()) %>% ungroup()
pivot_longer(cols = c(established_year, discontinued_year, active_post_offices), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
log_number_post_offices = log(n())
) %>% ungroup
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0)
) %>%
# group_by(active_post_offices) %>%
# summarize_by_time(established_year, .by = "year",
#                   active_post_offices = n()) %>% ungroup()
pivot_longer(cols = c(established_year, discontinued_year, active_post_offices), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
log_number_post_offices = log(n())
) %>% ungroup
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0)
) %>%
# group_by(active_post_offices) %>%
# summarize_by_time(established_year, .by = "year",
#                   active_post_offices = n()) %>% ungroup()
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumsum(active_post_offices),
log_number_post_offices = log(n())
) %>% ungroup
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0)
) %>%
# group_by(active_post_offices) %>%
# summarize_by_time(established_year, .by = "year",
#                   active_post_offices = n()) %>% ungroup()
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumsum(active_post_offices),
log_number_post_offices = log(n())
) %>% ungroup %>% tail(10)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = slidify(.f = sum(active_post_offices), .period = max(established_year) - min(established_year), .align = "left",.unlist = F)
)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(asc(established))
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
order_by(asc(established))
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
order_by(order_by = established)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = active_post_offices,
log_number_post_offices = log(n())
) %>% ungroup %>% tail(10)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumulative_active,
log_number_post_offices = log(n())
) %>% ungroup %>% tail(10)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumulative_active,
log_number_post_offices = log(n())
) %>% ungroup %>%
# mutate(label_text = str_glue("Number Post Offices: {scales::comma(number_post_offices, accuracy = 1)}")) %>%
plot_time_series(.date_var = year, .value = still_active_post_offices, .smooth = F,
.color_var = label,
.title = "Post Office Lifecycle in US",
.y_lab = "Number of Post Offices")
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1, TRUE ~ 0)) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumulative_active,
log_number_post_offices = log(n())
) %>%
mutate(cumulative_openings = cumsum(number_post_offices))
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumulative_active,
log_number_post_offices = log(n())
) %>% ungroup %>% tail(10)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = cumsum(n()),
still_active_post_offices = cumulative_active,
log_number_post_offices = log(n())
) %>% ungroup() %>% tail(10)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumulative_active,
log_number_post_offices = log(n())
) %>%
mutate(cumulative_events = cumsum(number_post_offices)) %>% ungroup() %>% tail(10)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumulative_active
# ,log_number_post_offices = log(n())
)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumulative_active
# ,log_number_post_offices = log(n())
) %>% ungroup(year)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumulative_active
# ,log_number_post_offices = log(n())
) %>% ungroup(year) %>%
mutate(cumulative_events = cumsum(number_post_offices))
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumulative_active
# ,log_number_post_offices = log(n())
) %>% ungroup(year) %>%
mutate(cumulative_events = cumsum(number_post_offices)) %>% ungroup() %>% tail(10)
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumulative_active
# ,log_number_post_offices = log(n())
) %>% ungroup() %>%
mutate(cumulative_events = cumsum(number_post_offices)) %>% ungroup() %>% tail(10)
processed_data_tbl
processed_data_tbl %>%
filter(coordinates == TRUE) %>%
filter(nchar(established) == 4) %>%
filter(nchar(discontinued) == 4 | is.na(discontinued)) %>%
arrange(order_by = established) %>%
mutate(established_year = ymd(established, truncated = 2L),
discontinued_year = ymd(discontinued, truncated = 2L),
active_post_offices = case_when(
is.na(discontinued_year) ~ 1,
TRUE ~ 0),
cumulative_active = cumsum(active_post_offices)
) %>%
pivot_longer(cols = c(established_year, discontinued_year), names_to = "label", values_to = "year") %>%
group_by(label) %>%
summarize_by_time(year, .by = "year",
number_post_offices = n(),
still_active_post_offices = cumulative_active
# ,log_number_post_offices = log(n())
) %>% ungroup()
tidytuesdayR::use_tidytemplate()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidytuesdayR)
library(scales)
theme_set(theme_light())
tt <- tt_load("2021-04-13")
tt$post_offices
