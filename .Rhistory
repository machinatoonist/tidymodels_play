filter(year %% 4 == 0) %>%
inner_join(states_map, by = "state") %>%
ggplot(aes(long, lat, group = group, fill = n_post_offices)) +
geom_polygon() +
scale_fill_gradient2(low = "blue", high = "red",
mid = "pink", midpoint = 2000) +
transition_manual(year) +
theme_map() +
labs(fill = "Post offices",
title = "{current_frame} ")
anim_save("media/post_offices_over_time.gif")
post_office_years <- post_offices %>%
filter(established <= 2021) %>%
select(name, state, established, discontinued, latitude, longitude) %>%
replace_na(list(discontinued = 2003)) %>%
filter(discontinued <= 2021,
established >= 1750) %>%
mutate(year = map2(established, discontinued, seq)) %>%
unnest(year)
post_office_years %>%
filter(year == 2000)
post_office_years %>%
filter(year == 2000) %>%
ggplot(aes(longitude, latitude)) +
geom_point(size = 0.2)
post_office_years %>%
filter(year == 2000,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude)) +
geom_point(size = 0.2)
post_office_years %>%
filter(year == 2000,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude)) +
geom_point(size = 0.2) +
transition_manual(year)
post_office_years %>%
filter(year %% 2 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude)) +
geom_point(size = 0.2) +
transition_manual(year)
post_office_years %>%
filter(year %% 10 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude)) +
geom_point(size = 0.2) +
transition_manual(year)
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = state)) +
geom_point(size = 0.2) +
transition_manual(year)
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "none")
post_offices %>%
filter(established <= 2021) %>%
select(name, state, established, discontinued, latitude, longitude) %>%
replace_na(list(discontinued = 2003)) %>%
filter(discontinued <= 2021,
established >= 1750) %>%
mutate(year = map2(established, discontinued, seq)) %>%
unnest(year)
post_offices %>% glimpse()
anim_save("media/post_office_location_over_time.gif")
post_office_years <- post_offices %>%
filter(established <= 2021) %>%
select(name, state, established, discontinued, latitude, longitude) %>%
replace_na(list(discontinued = 2003)) %>%
filter(discontinued <= 2021,
established >= 1750) %>%
mutate(year = map2(established, discontinued, seq)) %>%
mutate(status = case_when(
discontinued == 2003 ~ "Open",
TRUE ~ "Closed"
))
post_office_years <- post_offices %>%
filter(established <= 2021) %>%
select(name, state, established, discontinued, latitude, longitude) %>%
replace_na(list(discontinued = 2003)) %>%
filter(discontinued <= 2021,
established >= 1750) %>%
mutate(year = map2(established, discontinued, seq)) %>%
mutate(status = case_when(
discontinued == 2003 ~ "Open",
TRUE ~ "Closed"
)) %>%
unnest(year)
post_office_years
post_offices_cumulative <- post_office_years %>%
count(year,
state = fct_lump(state, 16),
name = "n_post_offices")
post_offices_cumulative %>%
mutate(state = fct_reorder(state, -n_post_offices, .fun = sum)) %>%  # order states by number
filter(state != "Other") %>%
ggplot(aes(year, n_post_offices, fill = state)) +
geom_area() +
labs(x = "Year",
y = "# of post offices currently active in US",
title = "Where and when were the most post offices opened?") +
facet_wrap(~ state) +
theme(legend.position = "none")
post_office_closures <- post_offices %>%
filter(established <= 2021) %>%
filter(discontinued <= 2021,
discontinued >= 1750,
established >= 1750) %>%
filter(!is.na(discontinued)) %>%
count(state = fct_lump(state, 16),
decade = 10 * discontinued %/% 10,  # floor years to decades
name = "n_closures") %>%
mutate(state = fct_reorder(state, -n_closures, .fun = sum)) %>%
filter(state != "Other")
post_office_closures %>%
ggplot(aes(decade, n_closures, fill = state)) +
geom_area() +
labs(x = "Year",
y = "# of post offices closed in each decade",
title = "When and where were the most post offices closed?") +
facet_wrap(~ state) +
theme(legend.position = "none")
post_office_closures %>%
inner_join(post_offices_cumulative, by = c("state", "decade" = "year")) %>%
mutate(pct_closed = n_closures/n_post_offices) %>%
filter(n_post_offices >= 50) %>%
filter(state %in% c("KY", "PA")) %>%
ggplot(aes(decade, pct_closed, color = state)) +
geom_line() +
scale_y_continuous(labels = percent) +
labs(y = "% of post offices open at start of decade that closed")
post_office_years %>%
filter(year == 2003) %>%
count(state, sort = TRUE)
states_map <- map_data("state") %>%
as_tibble() %>%
mutate(state = state.abb[match(region, str_to_lower(state.name))]) %>%
replace_na(list(state = "DC"))
state_pop_2000 <- us_state_populations %>%
filter(year == 2000) %>%
mutate(state = state.abb[match(state, state.name)]) %>%
replace_na(list(state = "DC"))
state_pops <- us_state_populations %>%
mutate(state = state.abb[match(state, state.name)]) %>%
replace_na(list(state = "DC"))
post_office_years %>%
filter(year == 2000) %>%
count(state, sort = TRUE) %>%
inner_join(state_pop_2000, by = "state") %>%
mutate(post_office_density = n/(population / 1e6)) %>%
inner_join(states_map, by = "state") %>%
ggplot(aes(long, lat, group = group, fill = post_office_density)) +
geom_polygon() +
scale_fill_gradient2(low = "blue", high = "red", midpoint = 250) +
theme_map() +
labs(fill = "Density of post offices/M people")
post_offices_cumulative_all <- post_office_years %>%
count(
year,
state,
name = "n_post_offices"
)
by_state_year <- post_offices_cumulative_all %>%
left_join(state_pops, by = c("year", "state")) %>%
mutate(post_office_density = n_post_offices/(population / 1e6))
by_state_year %>%
# filter(year %% 80 == 0) %>%
filter(year %in% c(1800, 1850, 1900, 1950)) %>%
inner_join(states_map, by = "state") %>%
ggplot(aes(long, lat, group = group, fill = n_post_offices)) +
geom_polygon() +
scale_fill_gradient2(low = "blue", high = "red",
mid = "pink", midpoint = 2000) +
facet_wrap( ~ year) +
theme_map() +
labs(fill = "Post offices")
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "none")
library(tidyquant)
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "none") +
theme_tufte()
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "none") +
theme_tq_dark()
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "none") +
theme_tq_dark() +
theme_tq()
library(viridis)
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "none") +
scale_color_viridis(discrete = TRUE, option = "D")+
anim_save("media/post_office_location_over_time.gif")
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "bottom") +
scale_color_viridis(discrete = TRUE, option = "D")
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "bottom") +
scale_color_viridis(discrete = TRUE, option = "C")
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "bottom") +
scale_color_viridis(discrete = TRUE, option = "B") +
labs(fill = "Post offices",
title = "{current_frame} ")
theme_set(theme_economist())
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "bottom") +
scale_color_viridis(discrete = TRUE, option = "B") +
labs(title = "Post offices: {current_frame} ")
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "bottom") +
scale_color_viridis(discrete = TRUE, option = "B") +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
anim_save("media/post_office_location_over_time_yellow.gif")
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
theme(legend.position = "bottom") +
scale_color_viridis(discrete = TRUE, option = "A") +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
anim_save("media/post_office_location_over_time_yellow_A.gif")
tt
tt
tt
tt <- tt_load("2021-04-13")
tt
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map()
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
scale_color_viridis(discrete = TRUE, option = "A") +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
install.packages("mapproj")
post_office_years %>%
filter(year %% 5 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
scale_color_viridis(discrete = TRUE, option = "A") +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
post_office_years %>%
filter(year == 1900,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1, alpha = 0.25) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
scale_color_viridis(discrete = TRUE, option = "A") +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
post_office_years %>%
filter(year == 1900,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1, alpha = 0.25) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
scale_color_brewer() +
# scale_color_viridis(discrete = TRUE, option = "A") +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
post_office_years %>%
filter(year %% 2 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1, alpha = 0.25) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
scale_color_brewer() +
# scale_color_viridis(discrete = TRUE, option = "A") +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
post_office_years %>%
filter(year %% 2 == 0,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1, alpha = 0.25) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
scale_color_viridis(discrete = TRUE, option = "A", direction = -1) +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
post_office_years %>%
# filter(year %% 2 == 0,
filter(year == 1900,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1, alpha = 0.25) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
# scale_color_viridis(discrete = TRUE, option = "A", direction = -1) +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
post_office_years %>%
# filter(year %% 2 == 0,
filter(year == 1900,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1, alpha = 0.25) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
theme_tk() +
# scale_color_viridis(discrete = TRUE, option = "A", direction = -1) +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
library(tidyquant)
post_office_years %>%
# filter(year %% 2 == 0,
filter(year == 1900,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1, alpha = 0.25) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
theme_tk() +
# scale_color_viridis(discrete = TRUE, option = "A", direction = -1) +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
library(tidyquant)
post_office_years %>%
# filter(year %% 2 == 0,
filter(year == 1900,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude, color = status)) +
geom_point(size = 0.1, alpha = 0.25) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
theme_tq() +
# scale_color_viridis(discrete = TRUE, option = "A", direction = -1) +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
post_office_years %>%
filter(year %% 2 == 0,
# filter(year == 1900,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude)) +
geom_point(size = 0.1, alpha = 0.25) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
# scale_color_viridis(discrete = TRUE, option = "A", direction = -1) +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
post_office_years %>%
filter(year %% 2 == 0,
# filter(year == 1900,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude)) +
geom_point(size = 0.1, alpha = 0.25) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
# scale_color_viridis(discrete = TRUE, option = "A", direction = -1) +
labs(title = "US Post Offices: {current_frame} ",
subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
post_office_years %>%
filter(year %% 2 == 0,
# filter(year == 1900,
!state %in% c("HI", "AK")) %>%
ggplot(aes(longitude, latitude)) +
geom_point(size = 0.1, alpha = 0.25) +
transition_manual(year) +
borders("state") +
theme_map() +
coord_map() +
theme(legend.position = "bottom") +
# scale_color_viridis(discrete = TRUE, option = "A", direction = -1) +
labs(title = "US Post Offices: {current_frame} ",
# subtitle = "Grouped by Status in 2003",
x = "Longitude",
y = "Latitude")
anim_save("media/post_office_location_over_time_bw.gif")
